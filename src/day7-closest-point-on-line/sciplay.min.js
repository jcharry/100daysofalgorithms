!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("sciplay",[],e):"object"==typeof exports?exports.sciplay=e():t.sciplay=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return t[n].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){i(1),t.exports=i(2)},function(t,e){"use strict";!function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,i){var n=(new Date).getTime(),s=Math.max(0,16-(n-t)),r=window.setTimeout(function(){e(n+s)},s);return t=n+s,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}()},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(3),o=s(r),a=i(5),c=s(a),h=i(6),l=s(h),d=i(18),u=s(d),f=i(19),y=s(f),v=i(23),p=s(v),x=i(24),b=s(x),g=i(25),m=s(g),w=i(26),P=s(w),S=i(17),_=n(S),M=i(14),k=s(M),j=i(16),I=s(j),O=i(27),V=s(O),B=i(28),E=s(B),T=function(){return{Vector:r.Vector,vector:o.default,renderer:u.default,ray:c.default,system:l.default,wave:p.default,rect:y.default,point:P.default,polygon:m.default,circle:b.default,collisionTypes:E.default,constants:_,boundaryConstraint:k.default,linkConstraint:I.default,dev:{GJK:V.default}}};e.default=T,t.exports=e.default},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Vector=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=i(4),r=e.Vector=function(t,e){this.x=t||0,this.y=e||0};r.prototype={clone:function(){return new r(this.x,this.y)},set:function(t,e){return"x"===t?this.x=e:"y"===t&&(this.y=e),this},add:function(){var t=void 0,e=void 0;if(1===arguments.length){var i=arguments.length<=0?void 0:arguments[0];"object"===("undefined"==typeof i?"undefined":n(i))&&(t=i.x,e=i.y)}else 2===arguments.length&&"number"==typeof(arguments.length<=0?void 0:arguments[0])&&"number"==typeof(arguments.length<=1?void 0:arguments[1])&&(t=arguments.length<=0?void 0:arguments[0],e=arguments.length<=1?void 0:arguments[1]);return this.x+=t,this.y+=e,this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this},multiply:function(t){return"object"===("undefined"==typeof t?"undefined":n(t))?(this.x*=t.x,this.y*=t.y):"number"==typeof t&&(this.x*=t,this.y*=t),this},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},magnitudeSq:function(){return this.x*this.x+this.y*this.y},negate:function(){return this.x=-this.x,this.y=-this.y,this},rotate:function(t){var e=Math.sin(t),i=Math.cos(t),n=this.x*i-this.y*e,s=this.x*e+this.y*i;return this.x=n,this.y=s,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},angleTo:function(t){var e=this.magnitude(),i=t.magnitude(),n=this.dot(t),s=Math.acos(n/(e*i));return s},getAngle:function(t){if("DEGREES"===t)return(0,s.radToDeg)(Math.atan(this.y/this.x));var e=Math.atan2(this.y,this.x);return e<0?2*Math.PI+e:e},normalize:function(){var t=this.magnitude();return this.x/=t,this.y/=t,this},perp:function(t){if("right"===t){var e=this.x;this.x=this.y,this.y=-e}else{var i=this.x;this.x=-this.y,this.y=i}return this},distanceTo:function(t){return Math.sqrt((t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y))},scalarProject:function(t){return this.dot(t)/t.magnitude()},scalarProjectUnit:function(t){return this.dot(t)},vectorProject:function(t){var e=this.dot(t)/t.magnitudeSq();return this.x=t.x*e,this.y=t.y*e,this},vectorProjectUnit:function(t){var e=this.dot(t);return this.x=t.x*e,this.y=t.y*e,this}},r.prototype.translate=r.prototype.add;var o=function(t,e){return new r(t,e)};r.add=function(t,e){return new r(t.x+e.x,t.y+e.y)},r.subtract=function(t,e){return new r(t.x-e.x,t.y-e.y)},r.multiply=function(t,e){return"number"==typeof t&&"number"==typeof e?t*e:"object"===("undefined"==typeof t?"undefined":n(t))&&"number"==typeof e?new r(t.x*e,t.y*e):"object"===("undefined"==typeof e?"undefined":n(e))&&"number"==typeof t?new r(t*e.x,t*e.y):new r(t.x*e.x,t.y*e.y)},r.dot=function(t,e){return t.x*e.x+t.y*e.y},r.angleBetween=function(t,e){var i=t.magnitude(),n=e.magnitude(),s=t.dot(e),r=Math.acos(s/(i*n));return r},r.perp=function(t,e){switch(e){case"right":return new r(t.y,-t.x);default:return new r(-t.y,t.x)}},e.default=o},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.degToRad=function(t){return t*Math.PI/180},e.radToDeg=function(t){return 180*t/Math.PI},e.distance=function(t,e,i,n){return Math.sqrt((i-t)*(i-t)+(n-e)*(n-e))},e.map=function(t,e,i,n,s){return n+(s-n)*(t-e)/(i-e)}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(4),r=i(3),o=n(r),a={init:function(t,e,i,n){n&&(i=(0,s.degToRad)(i)),this.origin=(0,o.default)(t,e),this.direction=(0,o.default)(Math.cos(i),Math.sin(i)),this.invDirection=(0,o.default)(1/this.direction.x,1/this.direction.y),this.outerBodies=[],this.t=window.innerWidth>window.innerHeight?window.innerWidth:window.innerHeight;var r=this.origin.x,a=this.origin.y,c=this.origin.x+this.direction.x*this.t,h=this.origin.y+this.direction.y*this.t;this.slope=(h-a)/(c-r),this.numTests=0},trace:function(t){if(this.intersectionPoint=null,this.intersectingBody=null,this.intersectingSegment=null,this.rayID=t.currentRayId++,this.numTests=0,this.intersectHash(t.hash),this.intersectionPoint)return!0},intersectCircle:function(t){this.numTests+=1;var e=t.radius,i=(0,o.default)(this.direction.x*this.t,this.direction.y*this.t),n=r.Vector.subtract(this.origin,t.position),s=i.dot(i),a=2*n.dot(i),c=n.dot(n)-e*e,h=a*a-4*s*c;if(h<0);else{h=Math.sqrt(h);var l=(-a-h)/(2*s),d=(-a+h)/(2*s),u=void 0,f=void 0;if(l>=0&&l<=1)return u=this.origin.x+i.x*l,f=this.origin.y+i.y*l,this.updateIntersectionPoint({x:u,y:f},null,t),!0;if(d>=0&&d<=1)return u=this.origin.x+i.x*d,f=this.origin.y+i.y*d,this.updateIntersectionPoint({x:u,y:f},null,t),!0}return!1},intersectPolygon:function(t){var e=this;this.numTests+=1,t.isPointInterior(this.origin)&&this.outerBodies.push(t);var i=t.vertices,n=i.length,s=void 0;return i.forEach(function(i,r,o){var a=void 0;a=r===n-1?o[0]:o[r+1],s=e.intersectSegment([i,a]),s&&e.updateIntersectionPoint(s.intPoint,s.segVec,t)}),"undefined"!=typeof s},intersectSegment:function(t,e){var i=e?(0,o.default)(e.x*this.t,e.y*this.t):(0,o.default)(this.t*this.direction.x,this.t*this.direction.y),n=(0,o.default)(this.origin.x,this.origin.y),s=(0,o.default)(t[0].x,t[0].y),a=(0,o.default)(t[1].x-t[0].x,t[1].y-t[0].y),c=i.cross(a),h=r.Vector.subtract(s,n),l=h.cross(a),d=h.cross(i),u=void 0,f=void 0;if(0!==c&&(u=l/c,f=d/c),0!==c||0!==d){if(0===c&&0!==d)return!1;if(0!==c&&u>=0&&u<=1&&f>=0&&f<=1){var y=n.x,v=n.y,p=i.x,x=i.y,b=y+u*p,g=v+u*x;return{intPoint:(0,o.default)(b,g),segVec:a,t:u}}return!1}},intersectHash:function(t){var e=this,i=t.hash(this.origin),n=i.row,s=i.col,r=s,o=n,a=void 0,c=void 0,h=void 0,l=void 0,d=this.direction.x<0?-1:1,u=this.direction.y<0?-1:1,f=t.cellSize;for(h=f/Math.abs(this.direction.x),l=f/Math.abs(this.direction.y),a=r*f-this.origin.x,c=o*f-this.origin.y,this.direction.x>=0&&(a+=f),this.direction.y>=0&&(c+=f),a/=this.direction.x,c/=this.direction.y;o<t.numRows&&o>-1&&r<t.numCols&&r>-1;){if(window.renderer.debug&&(window.ctx.beginPath(),window.ctx.globalAlpha=1,window.ctx.strokeStyle="orange",window.ctx.lineWidth=3,window.ctx.strokeRect(r*f,o*f,f,f)),t.contents[o]&&t.contents[o][r]&&0!==t.contents[o][r].length){var y=t.contents[o][r];y.forEach(function(t){if(t.intersectionPoints[e.rayID]){if("hit"===t.intersectionPoints[e.rayID].status)return void e.updateIntersectionPoint(t.intersectionPoints[e.rayID].intPoint,t.intersectionPoints[e.rayID].segVec,t)}else{var i=e.intersectAABB(t.aabb);if(i)switch(t.type){case"polygon":case"rectangle":e.intersectPolygon(t);break;case"circle":e.intersectCircle(t)}e.intersectionPoint?t.intersectionPoints[e.rayID]={status:"hit",intPoint:e.intersectionPoint,segVeg:e.intersectingSegment}:t.intersectionPoints[e.rayID]={status:"miss"}}})}if(void 0===a&&void 0===c)break;void 0===a?(c+=l,o+=u):void 0===c?(a+=h,r+=d):a<c?(a+=h,r+=d):a>=c&&(c+=l,o+=u)}return{hashCoordinates:{x:r,y:o},intPoint:this.intersectionPoint}},intersectAABB:function(t){var e=(t.min.x-this.origin.x)*this.invDirection.x,i=(t.max.x-this.origin.x)*this.invDirection.x,n=Math.min(e,i),s=Math.max(e,i),r=(t.min.y-this.origin.y)*this.invDirection.y,o=(t.max.y-this.origin.y)*this.invDirection.y;n=Math.max(n,Math.min(r,o)),s=Math.min(s,Math.max(r,o));var a=s>=n&&s>=0;return a},updateIntersectionPoint:function(t,e,i){var n=this.origin.x,r=this.origin.y,o=t.x,a=t.y;this.intersectionPoint?(0,s.distance)(n,r,o,a)<(0,s.distance)(n,r,this.intersectionPoint.x,this.intersectionPoint.y)&&(this.intersectionPoint={x:o,y:a},this.intersectingBody=i,this.intersectingSegment=e):(this.intersectionPoint={x:o,y:a},this.intersectingBody=i,this.intersectingSegment=e)}},c=function(t,e,i,n){var s=Object.create(a);return s.init(t,e,i,n),s};e.default=c,t.exports=e.default},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=i(7),o=n(r),a=i(8),c=n(a),h=i(10),l=n(h),d=i(13),u=n(d),f=i(14),y=n(f),v=i(16),p=(n(v),i(17)),x={init:function(t,e){"function"==typeof t?this.loop=t:e=t,this.frames=[],this.waves=[],this.childWaves=[],this.bodies=[],this.points=[],this.width=e.width||600,this.height=e.height||300,this.collisionPairs={},this.nextBodyId=0,this.collideBoundary=void 0===e.collideBoundary||e.collideBoundary,console.log("can collide with boundary",this.collideBoundary),this.cellSize=this.calculateCellSize(e.cellSize||100),this.hash=this.initializeHash(this.cellSize,this.width,this.height),this._gravity=void 0===e.gravity?p.GRAVITY.LIGHT:e.gravity,this.broadphase=(0,c.default)(),this.narrowphase=(0,l.default)(),this.solver=(0,u.default)(),this.worldForce={x:0,y:0},this.currentRayId=0},calculateCellSize:function(t){var e=t?t:100;return this.width/Math.floor(this.width/e)},initializeHash:function(t,e,i){return(0,o.default)(t,e,i)},addChildWave:function(t){this.childWaves.push(t)},addObject:function(t){switch(t.type){case"rectangle":case"circle":case"polygon":t.id=this.nextBodyId++,t.addForce(this.worldForce.x,this.worldForce.y),this.bodies.push(t);break;case"point":this.points.push(t);break;case"incident":case"wave":this.waves.push(t);break;default:throw new Error("tried to add something that's not a body or a wave")}},add:function(t){var e=this;"object"===("undefined"==typeof t?"undefined":s(t))&&void 0!==t.length?t.forEach(function(t){e.addObject(t)}):this.addObject(t)},remove:function(t){var e=this;if("object"===("undefined"==typeof t?"undefined":s(t))&&void 0!==t.length)t.forEach(function(t){var i=e.bodies.indexOf(t);i!==-1&&e.bodies.splice(i,1)});else{var i=this.bodies.indexOf(t);i!==-1&&this.bodies.splice(i,1)}return this},update:function(t){var e=this;this.hash.clear(),this.bodies.forEach(function(t){t.constraints=[],e.hash.insertBody(t)}),this.points.forEach(function(t){t.constraints=[]}),this.loop&&this.loop(),this.worldForceNeedsSet&&(this.bodies.forEach(function(t){t.setForce(e.worldForce.x,e.worldForce.y)}),this.worldForceNeedsSet=!1),this.worldForceNeedsUpdate&&(this.bodies.forEach(function(t){t.addForce(e.worldForce.x,e.worldForce.y)}),this.worldForceNeedsUpdate=!1),this.bodies.forEach(function(i){if(e.collideBoundary){var n=(0,y.default)(i,e);i.constraints.push(n)}i.update(t)});var i=this.broadphase.getCollisionPairs(this.bodies,this.hash),n=void 0;return i&&Object.keys(i).length>0&&(n=this.narrowphase.checkForCollisions(i)),n&&n.length>0&&n.forEach(function(t){e.solver.solveCollision(t)}),this.bodies.forEach(function(t){t.constraints.forEach(function(t){e.solver.solveConstraint(t)})}),this.bodies.forEach(function(t){t.position.add(t.velocity)}),this.currentRayId=0,this.childWaves=[],this.waves.forEach(function(t){t.update(e),e.traverseWaves(t)}),this},traverseWaves:function(t){var e=this;0!==t.children.length&&t.children.forEach(function(t){e.addChildWave(t),e.traverseWaves(t)})},addWorldForce:function(t,e){this.worldForce.x+=t,this.worldForce.y+=e,this.worldForceNeedsUpdate=!0},setWorldForce:function(t,e){this.worldForce.x=t,this.worldForce.y=e,this.worldForceNeedsSet=!0}};Object.defineProperty(x,"gravityOn",{get:function(){return this._gravityOn},set:function(t){var e=this;this._gravityOn&&!t?(this._gravityOn=!1,this.worldForce.y-=this.gravity,this.bodies.forEach(function(t){t.addForce(0,-e.gravity)})):!this._gravityOn&&t&&(this._gravityOn=!0,this.worldForce.y+=this.gravity,this.bodies.forEach(function(t){t.addForce(0,e.gravity)}))}}),Object.defineProperty(x,"gravity",{get:function(){return this._gravity},set:function(t){var e=t-this._gravity;this.worldForce.y+=e,this._gravity+=e,this.bodies.forEach(function(t){t.addForce(0,e)})}});var b=function(t,e){var i=Object.create(x);return i.init(t,e),i};e.default=b,t.exports=e.default},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={init:function(t,e,i){this.cellSize=t,this.width=e,this.height=i,this.numRows=Math.ceil(i/t),this.numCols=e/t,this.contents={}},hash:function(t){return{col:Math.floor(t.x/this.cellSize),row:Math.floor(t.y/this.cellSize)}},insertBody:function(t){for(var e=this.hash(t.aabb.min),i=this.hash(t.aabb.max),n=e.row;n<i.row+1;n++)for(var s=e.col;s<i.col+1;s++)this.contents[n]?this.contents[n][s]?this.contents[n][s].push(t):this.contents[n][s]=[t]:(this.contents[n]={},this.contents[n][s]=[t])},updateBody:function(t){this.removeBody(t),this.insertBody(t)},removeBody:function(t){for(var e=this.hash(t.aabb.min),i=this.hash(t.aabb.max),n=e.row;n<i.row+1;n++)for(var s=e.col;s<i.col+1;s++){var r=this.contents[n][s].indexOf(t);r!==-1&&this.contents[n][s].splice(r,1)}},queryBody:function(t){for(var e=this.hash(t.aabb.min),i=this.hash(t.aabb.max),n=[],s=e.row;s<i.row+1;s++)for(var r=e.col;r<i.col+1;r++)this.contents[s][r].forEach(function(e){n.indexOf(e)===-1&&e!==t&&n.push(e)});return n},queryPoint:function(t){var e=this.hash(t);return e},clear:function(){this.contents={}}},n=function(t,e,n){var s=Object.create(i);return s.init(t,e,n),s};e.default=n,t.exports=e.default},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(9),r=n(s),o={aabbOverlap:function(t,e){return t.aabb.overlap(e.aabb)},canCollide:function(t,e){return!(!t.canCollide||!e.canCollide)},getCollisionPairs:function(t,e){this.collisionCounter=0;for(var i={},n=0;n<t.length;n++)for(var s=t[n],o=e.queryBody(s),a=0;a<o.length;a++){var c=o[a];if(this.canCollide(s,c)&&this.aabbOverlap(s,c)){var h=void 0;h=s.id<c.id?s.id+"-"+c.id:c.id+"-"+s.id;var l=(0,r.default)(s,c,h);i[h]||(i[h]=l)}}return i}},a=function(t){var e=Object.create(o);return e};e.default=a,t.exports=e.default},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={init:function(t,e,i){this.bodies=[t,e],this.index=i}},n=function(t,e,n){var s=Object.create(i);return s.init(t,e,n),s};e.default=n,t.exports=e.default},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=i(11),o=n(r),a={checkForCollisions:function(t){var e=[];if("object"===("undefined"==typeof t?"undefined":s(t))&&void 0===t.length)for(var i=Object.keys(t),n=0;n<i.length;n++){var r=t[i[n]],a=r.bodies[0],c=r.bodies[1],h=o.default.intersect(a,c);h&&(a.colliderList.push(h),c.colliderList.push(h),e.push(h))}else if("object"===("undefined"==typeof t?"undefined":s(t))&&t.length>0)for(var l=0;l<t.length;l++){var d=t[l],u=d.bodies[0],f=d.bodies[1],y=o.default.intersect(u,f);y&&(u.colliderList.push(y),e.push(y))}return e}},c=function(){var t=Object.create(a);return t};e.default=c,t.exports=e.default},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(3),r=i(12),o=n(r),a={};a.projectBody=function(t,e){if("rectangle"===t.type||"polygon"===t.type){for(var i=t.vertices[0].scalarProjectUnit(e),n=i,s=0;s<t.vertices.length;s++){var r=t.vertices[s],o=r.scalarProjectUnit(e);o<i?i=o:o>n&&(n=o)}return{min:i,max:n}}if("circle"===t.type){var a=t.interpolatedPosition.scalarProjectUnit(e);return{min:a-t.scaledRadius,max:a+t.scaledRadius}}},a.lineOverlap=function(t,e,i,n){return Math.max(0,Math.min(e,n)-Math.max(t,i))},a.intersect=function(t,e){return"rectangle"===t.type||"polygon"===t.type?"circle"===e.type?a.polycircle(t,e):a.polypoly(t,e):"circle"===t.type?"circle"===e.type?a.circlecircle(t,e):a.polycircle(t,e):void 0},a.circlecircle=function(t,e){var i=s.Vector.subtract(e.interpolatedPosition,t.interpolatedPosition),n=i.magnitude(),r=t.scaledRadius+e.scaledRadius;if(n<r)return(0,o.default)(t,e,i.normalize(),r-n)},a.polypoly=function(t,e){var i=[],n=void 0,r=void 0,a=t.vertices.length,c=e.vertices.length;"rectangle"===t.type&&(a=2);for(var h=0;h<a;h++){var l=t.vertices[h],d=t.vertices[h+1===t.vertices.length?0:h+1],u=s.Vector.subtract(d,l);u.normalize().perp(),i.push(u)}"rectangle"===e.type&&(c=2);for(var f=0;f<c;f++){var y=e.vertices[f],v=e.vertices[f+1===e.vertices.length?0:f+1],p=s.Vector.subtract(v,y);p.normalize().perp(),i.push(p)}for(var x=0;x<i.length;x++){var b=i[x],g=this.projectBody(t,b),m=this.projectBody(e,b),w=this.lineOverlap(g.min,g.max,m.min,m.max);if(0===w)return;n?w<n&&(n=w,r=b):(n=w,r=b)}return(0,o.default)(t,e,r,n)},a.polycircle=function(t,e){var i=void 0,n=void 0;"circle"===t.type?(n=t,i=e):(n=e,i=t);for(var r=[],a=void 0,c=void 0,h=i.vertices.length,l=void 0,d=0;d<h;d++){var u=i.vertices[d],f=i.vertices[d+1===i.vertices.length?0:d+1],y=s.Vector.subtract(f,u);y.normalize().perp(),r.push(y);var v=s.Vector.subtract(n.interpolatedPosition,u);l?v.magnitudeSq()<l.magnitudeSq()&&(l=v):l=v}r.push(l.normalize());for(var p=0;p<r.length;p++){var x=r[p],b=this.projectBody(i,x),g=this.projectBody(n,x),m=this.lineOverlap(b.min,b.max,g.min,g.max);if(0===m)return;a?m<a&&(a=m,c=x):(a=m,c=x)}return(0,o.default)(t,e,c,a)},e.default=a,t.exports=e.default},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={init:function(t,e,i,n){this.body1=t,this.body2=e,this.mtvaxis=i,this.overlap=n}},n=function(t,e,n,s){var r=Object.create(i);return r.init(t,e,n,s),r};e.default=n,t.exports=e.default},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(3),r=n(s),o={INELASTIC:"inelastic",ELASTIC:"elastic",getCollisionType:function(t,e){return"inelastic"===t.collisionType||"inelastic"===e.collisionType?this.INELASTIC:this.ELASTIC},solveCollision:function(t){var e=t.body1,i=t.body2,n=t.mtvaxis,s=t.overlap,o=Math.abs(n.x*s),a=Math.abs(n.y*s),c=(0,r.default)(o,a);this.getCollisionType(e,i);if(0!==o){var h=1;e.aabb.min.x<i.aabb.min.x&&(h=-1),e.static||(e.interpolatedPosition.x+=c.x/2*h),i.static||(i.interpolatedPosition.x-=c.x/2*h)}if(0!==a){var l=1;e.aabb.min.y<i.aabb.min.y&&(l=-1),e.static||(e.interpolatedPosition.y+=c.y/2*l),i.static||(i.interpolatedPosition.y-=c.y/2*l)}},solveConstraint:function(t){t.solve()}},a=function(){var t=Object.create(o);return t};e.default=a,t.exports=e.default},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(15),r=n(s),o=(i(3),function(t,e,i){var n=(0,r.default)("boundary",t,null,e,i);return n.solve=function(){var i=t.aabb.min.x,n=t.aabb.min.y,s=t.aabb.max.x,r=t.aabb.max.y;switch(t.type){case"circle":var o=t.aabb.min.x,a=t.aabb.min.y,c=t.aabb.max.x,h=t.aabb.max.y,l=t.radius;o<0&&t.setX(l),a<0&&t.setY(l),c>e.width&&t.setX(e.width-l),h>e.height&&t.setY(e.height-l);break;case"rectangle":var d=s-i,u=r-n;i<0&&t.setX((d-t.width)/2),n<0&&t.setY(u-t.height)/2,s>e.width&&t.setX(e.width-t.width-(d-t.width)/2),r>e.height&&t.setY(e.height-t.height-(u-t.height)/2);break;case"polygon":var f=s-i,y=r-n;i<0&&t.setX(0),n<0&&t.setY(0),s>e.width&&t.setX(e.width-t.width-(f-t.width)/2),r>e.height&&t.setY(e.height-t.height-(y-t.height)/2)}},n});e.default=o,t.exports=e.default},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={init:function(t,e,i,n,s){this.body1=t,this.body2=e,this.bounds=i,this.distance=n,this.forces=s},enable:function(){this.body1&&this.body1.constraints.push(this),this.body2&&this.body2.constraints.push(this)}},n=function(){var t=arguments.length<=0?void 0:arguments[0],e=Object.create(i);switch(e.type=arguments.length<=0?void 0:arguments[0],t){case"boundary":e.init(arguments.length<=1?void 0:arguments[1],null,arguments.length<=3?void 0:arguments[3],null,null);break;case"link":e.init(arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2],null,arguments.length<=3?void 0:arguments[3],null);break;default:throw new Error("I don't know how to handle that kind of constraint!")}return e};e.default=n,t.exports=e.default},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(15),r=n(s),o=function(t,e,i){var n=(0,r.default)("link",t,e,i);return n.type="link",n.solve=function(){if("point"===e.type){var i=e.position.clone();i.subtract(t.interpolatedPosition);var n=t.velocity,s=t.force,r=t.mass,o=(i.dot(s)-n.dot(n)*r)/i.dot(i),a={x:i.x*o,y:i.y*o};t.velocity.add(a),console.log(i.magnitude())}},n};e.default=o,t.exports=e.default},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={LIGHT:4e-5,MEDIUM:1e-4,HEAVY:4e-4},n={Rock:{density:.6,restitution:.1},Wood:{density:.3,restitution:.2},Metal:{density:1.2,restitution:.05},BouncyBall:{density:.3,restitution:.8},SuperBall:{density:.3,restitution:.95},Pillow:{density:.1,restitution:.2},Static:{density:0,restitution:.4}};e.MATERIALS=n,e.GRAVITY=i},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var s=i(4),r=n(s),o={init:function(t,e){this.clearBackground=void 0===e.clearBackground||e.clearBackground,console.log(this.clearBackground),this.background=e.background||"black",this.borderColor=e.borderColor,this.system=t,this.canvas="undefined"==typeof e.canvas?function(){var t=document.createElement("canvas");return t.id="canvas",document.body.appendChild(t),t}():function(){var t=document.getElementById(e.canvas);return t}(),this.canvas.width=this.system.width,this.canvas.height=this.system.height,this.ctx=this.canvas.getContext("2d"),this.ctx.beginPath(),this.ctx.globalAlpha=1,this.ctx.fillStyle=this.background,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.frameTimestep=0,this.fps=60,this.dt=1e3/this.fps,this.debug=void 0!==e.debug&&e.debug,this.debug&&(window.renderer=this,window.ctx=this.canvas.getContext("2d"))},resize:function(t,e,i){this.canvas.width=t,this.canvas.height=e,this.system.width=t,this.system.height=e,this.system.cellSize=this.system.calculateCellSize(i||this.system.cellSize),this.system.hash=this.system.initializeHash(this.system.cellSize,t,e)},drawPoint:function(t){this.ctx.beginPath(),this.ctx.ellipse(t.position.x,t.position.y,3,3,0,0,2*Math.PI),this.ctx.strokeStyle="red",this.ctx.lineWidth=1,this.ctx.stroke()},drawBody:function(t,e){var i=this;if(t.debug){if("circle"===t.type){this.ctx.beginPath();var n=t.position.x,s=t.position.y,r=Math.cos(t.rotation)*t.radius,o=Math.sin(t.rotation)*t.radius;this.ctx.moveTo(n,s),this.ctx.lineTo(n+r,s+o),this.ctx.strokeStyle="red",this.ctx.stroke()}this.ctx.beginPath();var a=t.aabb,c=a.min.x,h=a.min.y,l=a.max.x-c,d=a.max.y-h;this.ctx.rect(c,h,l,d),this.ctx.strokeStyle="red",this.ctx.lineWidth=.5,this.ctx.stroke()}if(this.debug){this.ctx.beginPath(),this.ctx.globalAlpha=1,this.ctx.strokeStyle="red",this.ctx.lineWidth=1;var u=t.aabb,f=u.min.x,y=u.min.y,v=u.max.x-f,p=u.max.y-y;this.ctx.rect(f,y,v,p),this.ctx.stroke(),t.vertices&&t.vertices.forEach(function(t){i.ctx.beginPath(),i.ctx.strokeStyle="magenta",i.ctx.lineWidth=2,i.ctx.ellipse(t.x,t.y,4,4,0,0,2*Math.PI),i.ctx.stroke()}),t.centroid&&(this.ctx.beginPath(),this.ctx.strokeStyle="red",this.ctx.lineWidth=3,this.ctx.ellipse(t.centroid.x,t.centroid.y,3,3,0,0,2*Math.PI),this.ctx.stroke())}switch(this.ctx.beginPath(),this.ctx.globalAlpha=1,t.type){case"rectangle":this.ctx.fillStyle=t.style.fillStyle,this.ctx.lineWidth=t.style.lineWidth,this.ctx.strokeStyle=t.style.strokeStyle,this.ctx.lineJoin="miter",t.debug&&(t.colliderList.length>0?this.ctx.strokeStyle="green":this.ctx.strokeStyle="white"),this.ctx.moveTo(t.vertices[0].x,t.vertices[0].y);for(var x=1;x<t.vertices.length;x++){var b=t.vertices[x];this.ctx.lineTo(b.x,b.y)}this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke();break;case"circle":this.ctx.fillStyle=t.style.fillStyle,this.ctx.lineWidth=t.style.lineWidth,this.ctx.strokeStyle=t.style.strokeStyle,t.debug&&(t.colliderList.length>0?this.ctx.strokeStyle="green":this.ctx.strokeStyle="white"),this.ctx.ellipse(t.position.x,t.position.y,t.scaledRadius,t.scaledRadius,0,0,2*Math.PI),this.ctx.stroke();break;case"polygon":this.ctx.fillStyle=t.style.fillStyle,this.ctx.lineWidth=t.style.lineWidth,this.ctx.strokeStyle=t.style.strokeStyle,this.ctx.lineJoin="miter",this.ctx.moveTo(t.vertices[0].x,t.vertices[0].y);for(var g=1;g<t.vertices.length;g++){var m=t.vertices[g];this.ctx.lineTo(m.x,m.y)}this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke()}},drawWave:function(t){var e="DEGREES"===t.mode?r.degToRad(t.direction):t.direction;this.ctx.fillStyle=t.style.fillStyle,this.ctx.lineWidth=t.style.lineWidth,this.ctx.strokeStyle=t.style.strokeStyle,this.ctx.globalAlpha=r.map(t.intensity,0,1,.1,1),this.debug&&("incident"===t.type?(this.ctx.beginPath(),this.ctx.fillStyle="yellow",this.ctx.ellipse(t.position.x,t.y,3,3,0,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke(),this.ctx.strokeStyle="green"):"refracted"===t.type?this.ctx.strokeStyle="blue":"reflected"===t.type&&(this.ctx.strokeStyle="orange")),this.ctx.beginPath(),this.ctx.moveTo(t.position.x,t.position.y),t.ray.intersectionPoint?(this.ctx.lineTo(t.ray.intersectionPoint.x,t.ray.intersectionPoint.y),this.ctx.stroke(),this.debug&&(this.ctx.beginPath(),this.ctx.strokeStyle="red",this.ctx.lineWidth=.5,this.ctx.ellipse(t.ray.intersectionPoint.x,t.ray.intersectionPoint.y,3,3,0,0,2*Math.PI),this.ctx.stroke())):(this.ctx.lineTo(2e3*Math.cos(e)+t.position.x,2e3*Math.sin(e)+t.position.y),this.ctx.stroke())},run:function(){var t=this;this.lastTick=0;var e=function e(i){t._requestID=window.requestAnimationFrame(e),i&&t.tick(i)};e()},tick:function(t){var e=t-this.lastTick;for(this.frameTimestep+=e,this.lastTick=t,this.frameTimestep>50&&(this.frameTimestep=50);this.frameTimestep>this.dt;)this.system.update(this.dt),this.frameTimestep-=this.dt;var i=this.frameTimestep/this.dt;this.render(i)},render:function(t){var e=this;this.clearBackground&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.beginPath(),this.ctx.globalAlpha=1,this.ctx.lineWidth=1,this.ctx.fillStyle=this.background,this.ctx.strokeStyle=this.borderColor,this.ctx.rect(0,0,this.canvas.width,this.canvas.height),this.ctx.fill(),this.ctx.stroke()),this.system.bodies.forEach(function(i){e.drawBody(i,t)}),this.debug&&this.system.points.forEach(function(t){e.drawPoint(t)}),this.system.waves.forEach(function(i){e.drawWave(i,t)}),this.system.childWaves.forEach(function(i){e.drawWave(i,t)}),this.debug===!0&&!function(){var t=e.system.hash.cellSize;e.ctx.globalAlpha=1,e.ctx.lineWidth=1;for(var i=0;i<e.system.hash.width;i+=t)for(var n=0;n<e.system.hash.height;n+=t)e.ctx.beginPath(),e.ctx.strokeStyle="green",e.ctx.rect(i,n,t,t),e.ctx.stroke();Object.keys(e.system.hash.contents).forEach(function(i){Object.keys(e.system.hash.contents[i]).forEach(function(n){0!==e.system.hash.contents[i][n].length&&(e.ctx.beginPath(),e.ctx.strokeStyle="red",e.ctx.lineWidth=1,e.ctx.rect(n*t,i*t,t,t),e.ctx.stroke())})})}()},setSize:function(t,e){this.canvas.width=t,this.canvas.height=e},stop:function(){cancelAnimationFrame(this._requestID)},start:function(){this.render(this.system)}},a=function(t,e){var i=Object.create(o);return i.init(t,e),i};e.default=a,t.exports=e.default},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(20),r=n(s),o=i(22),a=n(o),c=i(3),h=(n(c),function(t){t=t||{};var e=Object.create(r.default);return e.init(t),e.type="rectangle",e._mode=t.mode||"LEFT",e.inertia=e.mass/12*(e.height*e.height+e.width*e.width),e.invInertia=1/e.inertia,Object.defineProperty(e,"mode",{get:function(){return this._mode},set:function(t){if(this._mode!==t&&"rectangle"===this.type)switch(t){case"LEFT":case"CENTER":case"RIGHT":this._mode=t,this.updateVertices();break;default:console.warn("Cannot set mode to "+t)}else console.warn("'mode' is only available on rectangles")}}),e.isPointInterior=function(t,i){var n=e.position.x,s=e.position.y;return t>=n&&t<=n+e.width&&i>=s&&i<=s+e.height},e.updateVertices(),e.aabb=(0,a.default)(e),e});e.default=h,t.exports=e.default},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=i(21),a=s(o),c=i(3),h=s(c),l=i(4),d=(n(l),{init:function(t){return t=t||{},0===Object.keys(t).length&&t.constructor===Object&&console.warn("You probably should initialize body objects with some values...just sayin"),this.style={fillStyle:t.fillStyle||"rgba(0,0,0,0)",lineWidth:t.lineWidth||2,strokeStyle:t.strokeStyle||"#abcabc"},this.height=t.height||10,this.width=t.width||10,this._mass=t.mass||1,this.invMass=1/this._mass,this.position=(0,h.default)(t.x||0,t.y||0),this.positionPrev=this.position.clone(),this.interpolatedPosition=this.position.clone(),this.velocity=(0,h.default)(t.velocity&&t.velocity.x||0,t.velocity&&t.velocity.y||0),this.force=(0,h.default)(t.force&&t.force.x||0,t.force&&t.force.y||0),this.torque=void 0===t.torque?0:t.torque,this._scale=1,this._rotation=void 0===t.rotation?0:t.rotation,this.rotationPrev=this._rotation,this.angularVelocity=void 0===t.angularVelocity?0:t.angularVelocity,this.static=t.static===!0,this.canCollide=t.canCollide!==!1,this.collisionType=t.collisionType||"elastic",this.colliderList=[],this.restitution=.1,this.refractiveIndex=t.refractiveIndex||1,this.material=t.material||"GLASS",this.materialColor=t.fillStyle||"black",this.mirror=t.mirror||!1,this.intersectionPoints={},this.debug=void 0!==t.debug&&t.debug,
t.material&&t.refractiveIndex?(this.refractiveIndex=t.refractiveIndex,this.material=t.material,console.warn("Setting both the material and the refractive index at the same time may cause some unexpected behavior")):t.material?a.default[this.material]?this.refractiveIndex=a.default[this.material].refractiveIndex:void 0===this.material||null===this.material?(this.material="default",this.refractiveIndex=1):console.error("the material "+this.material+" is not recognized. See the docs for supported default materials"):t.refractiveIndex?this.refractiveIndex=t.refractiveIndex:this.refractiveIndex=1.33,this},freeze:function(){return this.setPosition(this.position.x,this.position.y),this},unfreeze:function(){return this.static=!1,this},translate:function(){return 1===arguments.length?"object"===r(arguments.length<=0?void 0:arguments[0])&&this.position.add(arguments.length<=0?void 0:arguments[0]):2===arguments.length&&"number"==typeof(arguments.length<=0?void 0:arguments[0])&&"number"==typeof(arguments.length<=1?void 0:arguments[1])&&(this.position.x+=arguments.length<=0?void 0:arguments[0],this.position.y+=arguments.length<=1?void 0:arguments[1]),this.updateVertices&&this.updateVertices(),this},rotate:function(t){return this.rotation+=t,this},updateVertices:function(){var t=this;switch(this.type){case"rectangle":var e=this.width,i=this.height,n=this.interpolatedPosition.x,s=this.interpolatedPosition.y;switch(this._mode){case"CENTER":n-=e/2,s-=i/2;break;case"RIGHT":n-=e}this.centroid=(0,h.default)((n+(n+e))/2,(s+(s+i))/2),this.vertices=[(0,h.default)(n,s),(0,h.default)(n+e,s),(0,h.default)(n+e,s+i),(0,h.default)(n,s+i)],0===this.angularVelocity&&0===this._rotation&&0===this._scale||this.vertices.forEach(function(e){e.translate(-t.centroid.x,-t.centroid.y).rotate(t._rotation).multiply(t._scale).translate(t.centroid.x,t.centroid.y)});break;case"polygon":this.updateVertices=function(){var t=this;this.centroid={x:0,y:0},this.vertices.forEach(function(e,i){var n=t._relativeVertices[i];e.x=n.x+t.interpolatedPosition.x,e.y=n.y+t.interpolatedPosition.y,t.centroid.x+=e.x,t.centroid.y+=e.y}),this.centroid.x/=this.vertices.length,this.centroid.y/=this.vertices.length,0===this.angularVelocity&&0===this._rotation&&0===this._scale||this.vertices.forEach(function(e){e.translate(-t.centroid.x,-t.centroid.y).rotate(t._rotation).multiply(t._scale).translate(t.centroid.x,t.centroid.y)})};break;default:return}},addForce:function(t,e){this.force.x+=t,this.force.y+=e},setForce:function(t,e){this.force.x=t,this.force.y=e},setPosition:function(t,e){this.position.x=t,this.position.y=e,this.positionPrev.x=t,this.positionPrev.y=e},setX:function(t){this.position.x=t,this.positionPrev.x=t},setY:function(t){this.position.y=t,this.positionPrev.y=t},setRotation:function(t){this.rotation=t,this.rotationPrev=t},update:function(t){var e=t*t,i=this.position.x-this.positionPrev.x,n=this.position.y-this.positionPrev.y;return this.velocity.x=i+this.force.x*this.invMass*e,this.velocity.y=n+this.force.y*this.invMass*e,this.positionPrev.x=this.position.x,this.positionPrev.y=this.position.y,this.interpolatedPosition=this.position.clone(),this.interpolatedPosition.add(this.velocity),this.angularVelocity=this.rotation-this.rotationPrev+this.torque*this.invInertia*e,this.rotationPrev=this.rotation,this.rotation+=this.angularVelocity,this.updateVertices&&this.updateVertices(),this.intersectionPoints={},this.colliderList=[],this.aabb.update(),this}});Object.defineProperty(d,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation=t,this.updateVertices&&this.updateVertices()}}),Object.defineProperty(d,"scale",{get:function(){return this._scale},set:function(t){this._scale=t,this.updateVertices?this.updateVertices():"circle"===this.type&&(this.scaledRadius=this.radius*t)}}),Object.defineProperty(d,"mass",{get:function(){return this._mass},set:function(t){this._mass=t,this.invMass=1/t}}),e.default=d,t.exports=e.default},function(t,e){t.exports={GLASS:{refractiveIndex:1.5},AIR:{refractiveIndex:1.000277}}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n={init:function(t){this.body=t;var e=this.findMinMax(t),i=e.min,n=e.max;this.max=n,this.min=i},findMinMax:function(){var t=this;if(!this.body.vertices){var e=this.body.interpolatedPosition.x,n=this.body.interpolatedPosition.y,s=this.body.scaledRadius;return{max:{x:e+s,y:n+s},min:{x:e-s,y:n-s}}}var r=function(){var e=void 0,i=void 0,n=void 0,s=void 0;return t.body.vertices.forEach(function(t){var r=t.x,o=t.y;"undefined"==typeof e?e=r:"undefined"!=typeof e&&r<e&&(e=r),"undefined"==typeof i?i=o:"undefined"!=typeof i&&o<i&&(i=o),"undefined"==typeof n?n=r:"undefined"!=typeof n&&r>n&&(n=r),"undefined"==typeof s?s=o:"undefined"!=typeof s&&o>s&&(s=o)}),{v:{max:{x:n,y:s},min:{x:e,y:i}}}}();if("object"===("undefined"==typeof r?"undefined":i(r)))return r.v},contains:function(t){var e=t.x,i=t.y;return e>=this.min.x&&e<=this.max.x&&i>=this.min.y&&i<=this.max.y},overlap:function(t){return!(this.max.x<t.min.x)&&(!(this.min.x>t.max.x)&&(!(this.max.y<t.min.y)&&!(this.min.y>t.max.y)))},update:function(){var t=this.findMinMax(),e=t.max,i=t.min;this.max=e,this.min=i}},s=function(t){var e=Object.create(n);return e.init(t),e};e.default=s,t.exports=e.default},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=(i(4),i(3)),r=n(s),o=i(5),a=n(o),c={init:function(t){t=t||{};var e=299792458;this.children=[],this.style={lineWidth:t.lineWidth||1,strokeStyle:t.strokeStyle||"#456abc",opacity:t.opacity||1},this.x=t.x||10,this.y=t.y||10,this.position=(0,r.default)(t.x,t.y),this.waveSpeed=t.waveSpeed||e,this.frequency=t.frequency||1e3,this.wavelength=this.waveSpeed/this.frequency,this.velocity=t.velocity||(0,r.default)(0,0),this.direction=t.direction||0,this.mode=t.mode||"RADIAN",this.intensity=t.intensity||1,this.type=t.type||"incident",this.parent=t.parent||null,this.n1=t.n1||1,this.n2=t.n2||1,this.lastIntersection={},this.ray=(0,a.default)(this.position.x,this.y,this.direction,"DEGREES"===this.mode||null)},update:function(t){this.ray.trace(t),this.children=[],this.ray.intersectionPoint&&(this.lastIntersection=this.ray.intersectionPoint,this.children=this.createChildren(),this.children.forEach(function(e){e.update(t)}))},createChildren:function(){var t=this,e=void 0,i=this.ray.intersectingBody.type;"rectangle"===i||"polygon"===i?!function(){var i=t.ray.intersectingSegment;i.normalize();var n=(i.dot(t.ray.direction),[(0,r.default)(-i.y,i.x),(0,r.default)(i.y,-i.x)]),s=t;n.forEach(function(t){t.dot(s.ray.direction)<0&&(e=t)})}():"circle"===i&&!function(){var i=t.ray.intersectingBody.position.x,n=t.ray.intersectingBody.position.y,s=t.ray.intersectionPoint.x,o=t.ray.intersectionPoint.y,a=(0,r.default)(s-i,o-n),c=(0,r.default)(i-s,n-o);a.normalize(),c.normalize();var h=[a,c],l=t;h.forEach(function(t){t.dot(l.ray.direction)<0&&(e=t)}),void 0===e&&(e=h[0])}();var n=(2*this.ray.direction.dot(e),e.clone());n.multiply(2*this.ray.direction.dot(e));var o=this.ray.direction.clone();if(o.subtract(n),"incident"===this.type&&this.ray.outerBodies.length>0&&(this.n1=this.ray.outerBodies[this.ray.outerBodies.length-1].refractiveIndex),this.ray.intersectingBody)switch(this.type){case"refracted":this.parent&&this.parent.ray.intersectingBody&&this.parent.ray.intersectingBody===this.ray.intersectingBody?(this.n1=this.parent.n2,this.n2=this.parent.n1):(this.n1=this.parent.n2,this.n2=this.ray.intersectingBody.refractiveIndex);break;case"reflected":this.parent&&this.parent.ray.intersectingBody&&this.parent.ray.intersectingBody===this.intersectingBody?(this.n1=this.parent.n1,this.n2=this.parent.n2):(this.n1=this.parent.n1,this.n2=this.ray.intersectingBody.refractiveIndex);break;case"incident":this.n2=this.ray.intersectingBody.refractiveIndex}else this.n1=1,this.n2=1;var a=Math.PI-this.ray.direction.angleTo(e),c=Math.asin(this.n1*Math.sin(a)/this.n2),l=this.n1/this.n2*(this.n1/this.n2)*(1-Math.cos(a)*Math.cos(a)),d=s.Vector.multiply(this.n1/this.n2,this.ray.direction),u=s.Vector.multiply(e,this.n1/this.n2*Math.cos(a)-Math.sqrt(1-l));d.add(u);var f=(this.n1-this.n2)/(this.n1+this.n2),y=f*f,v=void 0;this.n1<=this.n2?v=1-(Math.cos(a)<0?-Math.cos(a):Math.cos(a)):this.n1>this.n2&&(v=1-(Math.cos(c)<0?-Math.cos(c):Math.cos(c)));var p=y+(1-y)*Math.pow(v,5),x=1-p;Math.sin(a)>this.n2/this.n1&&(p=.95,x=0),this.ray.intersectingBody.mirror===!0&&(p=.9,x=0);var b=this.intensity*p,g=this.intensity*x,m=o.getAngle(),w=d.getAngle(),P=[];if(b>.01){var S=h({x:this.ray.intersectionPoint.x+Math.cos(m),y:this.ray.intersectionPoint.y+Math.sin(m),direction:m,intensity:b,type:"reflected",parent:this,n1:this.n1,n2:this.n2,lineWidth:this.style.lineWidth,strokeStyle:this.style.strokeStyle});P.push(S)}if(g>.01){var _=h({x:this.ray.intersectionPoint.x-e.x,y:this.ray.intersectionPoint.y-e.y,direction:w,intensity:g,type:"refracted",parent:this,n1:this.n1,n2:this.n2,lineWidth:this.style.lineWidth,strokeStyle:this.style.strokeStyle});P.push(_)}return P}},h=function(t){var e=Object.create(c);return e.init(t),e};e.default=h,t.exports=e.default},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(20),r=n(s),o=i(22),a=n(o),c=i(4),h=function(t){t=t||{};var e=Object.create(r.default);return e.init(t),e.radius=t.radius||10,e.scaledRadius=e.radius,e.type="circle",e.aabb=(0,a.default)(e),e.inertia=e.mass*e.radius*e.radius/2,e.invInertia=1/e.inertia,e.isPointInterior=function(t,i){var n=e.position.x,s=e.position.y;return(0,c.distance)(t,i,n,s)<=e.scaledRadius},e};e.default=h,t.exports=e.default},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(20),r=n(s),o=i(22),a=n(o),c=i(3),h=n(c),l=function(t){t=t||{};var e=Object.create(r.default);if(!t.vertices)throw new Error("Polygons MUST be initialized with vertices. See docs.");return e.init(t),e.type="polygon",e.inertia=1,e.invInertia=1/e.inertia,e._relativeVertices=[],e.vertices=[],t.vertices.forEach(function(i){e._relativeVertices.push((0,h.default)(i.x,i.y)),e.vertices.push((0,h.default)(t.x+i.x,t.y+i.y))}),e.isPointInterior=function(t,i){for(var n=!1,s=0,r=e.vertices.length-1;s<e.vertices.length;r=s++){var o=e.vertices[s],a=e.vertices[r],c=o.x,h=o.y,l=a.x,d=a.y,u=h>i!=d>i&&t<(l-c)*(i-h)/(d-h)+c;u&&(n=!n)}return n},e.updateVertices(),e.aabb=(0,a.default)(e),e};e.default=l,t.exports=e.default},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(3),r=n(s),o={init:function(t,e){this.position=(0,r.default)(t,e),this.type="point",this.constraints=[]}},a=function(t,e){var i=Object.create(o);return i.init(t,e),i};e.default=a,t.exports=e.default},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(3),r=n(s),o={intersect:function(t,e){if("rectangle"===t.type){if("rectangle"===e.type||"polygon"===e.type)return this.polypoly(t,e);if("circle"===e.type)return this.polycircle(t,e)}if("circle"===t.type){if("rectangle"===e.type||"polygon"===e.type)return this.polycircle(e,t);if("circle"===e.type)return this.circlecircle(t,e)}if("polygon"===t.type){if("rect"===e.type||"polygon"===e.type)return polypoly(t,e);if("circle"===e.type)return this.polycircle(t,e)}},polypoly:function(t,e){},polycircle:function(t,e){},circlecircle:function(t,e){},pointPoly:function(t,e,i){var n=Object.create(a),o=(0,r.default)(e,i),c=t.vertices,h=Math.floor(Math.random()*c.length);n.vertexA=c[h].clone();var l=s.Vector.subtract(o,n.vertexA),d=this.calculateSupportPoint(l,c);n.vertexB=d.clone();var u=n.line(e,i);l=s.Vector.subtract(o,u),d=this.calculateSupportPoint(l,c),n.vertexC=d.clone()},calculateSupportPoint:function(t,e){for(var i=0,n=e[i].dot(t),s=1;s<e.length;s++){var r=e[s].dot(t);r>n&&(i=s,n=r)}return e[i]},getVoronoiRegions:function(t){}},a={init:function(t,e,i){this.vertexA=t,this.vertexB=e,this.vertexC=i},point:function(t,e){if(this.vertexA)return this.vertexA},line:function(t,e){if(this.vertexA&&this.vertexB){var i=(0,r.default)(t,e),n=s.Vector.subtract(this.vertexB,this.vertexA),o=n.magnitude(),a=n.clone();a.normalize();var c=s.Vector.subtract(i,this.vertexA).dot(a)/o,h=s.Vector.subtract(this.vertexB,i).dot(a)/o;if(h<=0)return this.vertexB;if(c<=0)return this.vertexA;var l=s.Vector.multiply(this.vertexA,h),d=s.Vector.multiply(this.vertexB,c);return s.Vector.add(l,d)}},triangle:function(t,e){var i=(0,r.default)(t,e),n=this.vertexA,o=this.vertexB,a=this.vertexC,c=s.Vector.subtract(i,o),h=s.Vector.subtract(i,n),l=s.Vector.subtract(i,a),d=s.Vector.subtract(n,o),u=s.Vector.subtract(o,n),f=s.Vector.subtract(o,a),y=s.Vector.subtract(a,o),v=s.Vector.subtract(a,n),p=s.Vector.subtract(n,a);s.Vector.dot(c,d),s.Vector.dot(h,u),s.Vector.dot(l,f),s.Vector.dot(c,y),s.Vector.dot(h,v),s.Vector.dot(l,p)}};e.default=o,t.exports=e.default},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={ELASTIC:"elastic",INELASTIC:"inelastic",STATIC:"static"},t.exports=e.default}])});